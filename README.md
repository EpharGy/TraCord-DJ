# TraCord DJ

A comprehensive Discord bot for managing music requests, interacting with Traktor DJ software collections, and enhancing DJ workflow automation. This is a standalone GUI application suitable for personal DJ environments. Spout integration is included for cover art display in other supported applications.

> **üìù Version **: Current version in [`version.py`](version.py)

## Features

- **üñ•Ô∏è Standalone GUI Application**: Tkinter-based control panel with real-time monitoring
- **üéµ Dynamic Song Search**: Intelligent search with interactive selection
- **üìã Song Request Management**: Full CRUD operations with user permissions
- **üìÇ Collection Integration**: Automatic Traktor collection integration for data
- **üÜï New Song Tracking**: Display recently imported songs
- **üì¢ Live Streaming Notifications**: Broadcast notifications with role mentions
- **üîí Permission System**: Granular access control for different user roles or channels
- **üßπ Admin Controls**: Collection refresh and track history via GUI buttons
- **üìä Search Analytics**: Track and display search statistics
- **üéß Now Playing Song**: Traktor Broadcast Listening for Song/Artist details, integrated with collection details for advanced meta data (coverart, BPM, Key)
- **üñºÔ∏è Spout Cover Art Integration**: Send cover art to other applications via Spout (Windows only)

## Screenshots
# Main Interface
![TraCord DJ GUI](https://raw.githubusercontent.com/EpharGy/TraCord-DJ/main/assets/screenshots/gui_screenshot.png)

# Spout Cover Art Integration -> Nest Drop -> OBS
Any application that supports Spout can receive cover art from this bot, allowing you to display it in OBS or other software. (OBS does support spout directly via plugin)
![Spout Integration](https://raw.githubusercontent.com/EpharGy/TraCord-DJ/main/assets/screenshots/gui_spout_integration.png)

## Quick Start
**You must setup Various settings, settings.json will be created on first launch, these can then be set via the Settings button, Traktor path is the path with out the version folders, ie (C:/Users/user)/Documents/Native Instruments/). Discord Token, ID's etc**

## Commands

### Music Discovery
- `/song <search>` - Search for songs with interactive selection (restricted to designated channels)
- `/srbnew [days]` - Display newly added songs from the last N days (default: 7)

### Request Management
- `/srbreqlist` - Display all pending song requests
- `/srbreqdel <number|'all'|'self'|username>` - Delete song requests with flexible options

### Utility Commands
- `/srblive <message>` - Send live streaming notifications with role mentions (admin only)

## Configuration

### Environment Variables
- Update environment variables in the `.env` file, run application before use to generate one or copy from `.env.example` (non EXE) 

### üõ†Ô∏è For Developers

**Branches available:**
- `main` - Stable releases only
- `dev` - Active development (use this for contributions)

**Quick start:**
```bash
python gui.py  # Run the GUI application
```

## Running the Bot

### üöÄ GUI Application (Recommended)
- **Windows**: Double-click `start_bot.bat` or run the built executable
- **Cross-platform**: Run `python gui.py`

The GUI provides real-time monitoring, admin controls, and automatic bot startup.

## üß© Extending with Discord Cogs (Plugins)

This bot uses a dynamic cog loader! To add new discord features or commands, simply drop a `.py` file into the `cogs/` folder (if using EXE, create one where the exe is launched from). The bot will automatically load all cogs in this folder at startup‚Äîno need to edit the main code!

- **To add a new cog:**
  1. Place your `my_cool_feature.py` in the `cogs/` folder.
  2. Restart the bot. That's it! Your cog will be loaded automatically.
- **To remove a cog:**
  1. Delete or move the `.py` file from `cogs/`.
  2. Restart the bot.

> **Note for Contributors:** The `_internal_cogs.py` file is auto-managed and contains an always-up-to-date list of internal cogs. Do not edit this file manually.

## Project Structure

The bot uses a modular Discord.py Cogs architecture for better organization:

```
TraCord-DJ/
‚îú‚îÄ‚îÄ üöÄ Entry Points
‚îÇ   ‚îú‚îÄ‚îÄ debug_gui.py                # Debug GUI for development (optional)
‚îÇ   ‚îú‚îÄ‚îÄ gui.py                      # Main GUI application (recommended)
‚îÇ   ‚îú‚îÄ‚îÄ main.py                     # Command-line entry point (dynamic cog loader)
‚îÇ   ‚îú‚îÄ‚îÄ run_bot.py                  # Cross-platform launcher
‚îÇ   ‚îî‚îÄ‚îÄ start_bot.bat               # Windows batch launcher
‚îú‚îÄ‚îÄ üìÅ Core Application
‚îÇ   ‚îú‚îÄ‚îÄ cogs/                       # All bot features as plugins (just drop in .py files!)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ collection.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ music.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ music_requests.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ _internal_cogs.py      # Auto-managed: always-up-to-date list of internal cogs
‚îÇ   ‚îú‚îÄ‚îÄ extra_cogs/                # (gitignored) Personal/dev-only cogs, launchers, and 
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...                    # Any .py files here are loaded as cogs in dev, but not in packaged EXE
‚îÇ   ‚îú‚îÄ‚îÄ config/
|   |   ‚îú‚îÄ‚îÄ collection.json
|   |   ‚îú‚îÄ‚îÄ song_requests.json
|   |   ‚îú‚îÄ‚îÄ stats.json              # Search and usage statistics (auto-created)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings.py
‚îÇ   ‚îú‚îÄ‚îÄ gui/                        # GUI submodules (panels, controls, etc.)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gui_controls_stats.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gui_logconsole.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gui_now_playing.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ gui_songrequests.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ discord_bot.py          # Discord bot lifecycle/controller logic
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ traktor_listener.py     # Traktor Broadcast listener for Now Playing songs
‚îÇ   ‚îú‚îÄ‚îÄ utils/
|   ‚îÇ   |‚îÄ‚îÄ coverart.py             # Cover art extraction and caching
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ events.py               # Event handling and custom events
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ harmonic_keys.py        # Harmonic key detection and management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ helpers.py              # Utility functions and permission checks
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.py               # Logging setup and output capture
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ song_matcher.py         # Song matching and search utilities
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ song_request_highlight.py # Highlighting song requests
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stats.py                # Search and usage statistics management
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ traktor.py              # Traktor collection parsing and management
‚îÇ   ‚îî‚îÄ‚îÄ version.py                  # Version information
‚îú‚îÄ‚îÄ üé® Assets
‚îÇ   ‚îú‚îÄ‚îÄ assets/
|   |   ‚îú‚îÄ‚îÄ screenshots/
|   |   |   ‚îî‚îÄ‚îÄ gui_screenshot.png
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app_icon.png
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ app_icon.ico
‚îú‚îÄ‚îÄ üîß Development
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ üìñ Documentation
‚îÇ   ‚îú‚îÄ‚îÄ LICENSE
‚îÇ   ‚îú‚îÄ‚îÄ README.md
‚îÇ   ‚îî‚îÄ‚îÄ RELEASE.md
‚îú‚îÄ‚îÄ ‚öôÔ∏è Configuration
‚îÇ   ‚îú‚îÄ‚îÄ .gitignore
‚îÇ   ‚îî‚îÄ‚îÄ TraCord DJ.code-workspace
‚îî‚îÄ‚îÄ üìù Generated Files (git-ignored)
    ‚îî‚îÄ‚îÄ *.spec
```

> **Note:** The `gui/` folder contains all modular GUI panels and controls. The `services/` folder contains bot lifecycle logic. The `utils/` folder contains helpers, logging, and Traktor, Now Playing utilities.

## ‚öôÔ∏è Cog Loading Behavior

- All cogs in `cogs/` are always loaded and should be included in packaged builds.
- Any `.py` files in `extra_cogs/` (top-level only) are also loaded as cogs when running from source, but are **not** included in the EXE unless you add `--add-data=extra_cogs;extra_cogs` to your build.
- Errors for missing cogs in `extra_cogs` are suppressed for a clean dev experience.
- Use `extra_cogs/` for personal, experimental, or private cogs and files. This folder is gitignored by default.

## üñºÔ∏è Spout Cover Art Integration (Optional)

This app supports sending cover art to other applications via Spout (Windows only) using [Python-SpoutGL](https://github.com/jlai/Python-SpoutGL).

- **Spout is optional**: The rest of the app works even if you do not install SpoutGL.
- If you click the Spout button in the GUI without SpoutGL installed, you will see a warning message.

### To enable Spout support:
1. Install dependencies:
   ```bash
   pip install PyOpenGL glfw
   ```
2. Clone and install Python-SpoutGL:
   ```bash
   git clone https://github.com/jlai/Python-SpoutGL.git
   cd Python-SpoutGL
   pip install .
   ```

**Do not include the Python-SpoutGL source in your own repo.** Just document these steps for users who want Spout support.

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Contributing

1. Fork the repository
2. Create a feature branch
3. Commit your changes
4. Push to the branch
5. Create a Pull Request

## Settings Popup Panel (Planned)

### 1. Settings Dialog UI
- Create a `SettingsDialog` class (Tkinter Toplevel window).
- Dynamically generate form fields for each key in `settings.json` (text, int, bool, dropdown for enums like `FADE_STYLE`).
- Add "Save" and "Cancel" buttons.

### 2. Loading and Displaying Settings
- On dialog open, load current settings from `Settings._settings` (or reload from file).
- Populate the form fields with current values.

### 3. Saving and Applying Changes
- On "Save":
  - Validate and write changes to `settings.json`.
  - Call `Settings.reload()` to update in-memory settings.
  - For settings that affect the UI (e.g., `CONSOLE_PANEL_WIDTH`, `COVER_SIZE`), update the relevant widgets immediately.
  - For settings that affect services (e.g., port, Spout, etc.), restart or reinitialize those services as needed.
  - Optionally, show a message if a restart is required for some settings.

### 4. First-Run Experience
- On app startup, check for missing or incomplete `settings.json`.
- If missing or incomplete, automatically open the `SettingsDialog` and require the user to fill in required fields before proceeding.

### 5. Live Refresh
- For UI-related settings, update the UI immediately after saving.
- For service-related settings, stop and restart the relevant service (e.g., Traktor listener, Spout sender) with new settings.

### 6. (Optional) Advanced
- Add tooltips or help text for each setting.
- Add validation (e.g., port must be integer, token must not be empty).
- Allow restoring defaults.

**Summary:**
- Build a Tkinter popup for settings.
- Load, edit, and save all `settings.json` fields.
- Apply changes live where possible, or on next relevant action.
- Require setup on first run.
